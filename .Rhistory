rm(list = ls())
# Define project directory
cdir <- "C:/GitHub/NutNetCausalinf/"
######################################################
## BELOW THIS POINT, code should just run ##
setwd(cdir)
# load packages; version numbers are noted for each package used.
require(ggplot2) # 3.3.3
library(plyr) # 1.8.6
library(data.table) # v 1.13.6
library(AER) # v 1.2-9 ### Do we use this anymore???
library(sandwich) #3.0-0
library(foreign) # 0.8-80
library(car)  #v  3.0-10
library(lfe)  # 2.8-6
library(fixest)  # v 0.8.2
library(lme4)  # 1.1-26
library(texreg) # 1.37. 5  #### Do we use this anymore???
library(broom)  # v 0.7.4
library(tidyverse)  # v 1.3.0
library(RColorBrewer) #1.1-2
library(cowplot) # 1.1.1
library(corrplot)  # 0.84
###  *** Need to run ***
### purpose built functions
source("./code/r/useful_functions.R")
##########################################
## Analysis using small complete data ####
combonly <- TRUE  # combonly -> finalprocess_and_datachecks
comb <- fread("./data/processed/NutNetControlPlotData_v201804.csv",na.strings='NA')
source("./code/r/finalprocess_and_datachecks.R") ## Produces Table S1
MainMod_Rich     <- feols(log(live_mass) ~ log(rich)  | newplotid + site.by.yeardummy, comb)
summary(comb$site_code)
MainMod_Rich_sitecluster  <- feols(log(live_mass) ~ log(rich)  | newplotid + site.by.yeardummy, comb, cluster = "site_code")
summary(MainMod_Rich)
summary(MainMod_Rich_sitecluster)
MainMod_Rich     <- feols(log(live_mass) ~ log(rich)  | newplotid + site.by.yeardummy, comb)
MainMod_Rich_sitecluster  <- feols(log(live_mass) ~ log(rich)  | newplotid + site.by.yeardummy, comb, cluster = "site_code")
MainMod_RichEven <- feols(log(live_mass) ~ log(rich) + ihs(even) | newplotid + site.by.yeardummy, comb)
MainMod_Simpson  <- feols(log(live_mass) ~ log(simpson) | newplotid + site.by.yeardummy, comb)
MainMod_RichLag  <- feols(log(live_mass) ~ log(rich) + log(laggedrich) | newplotid + site.by.yeardummy, comb)
MainMod_RichEvenLag <- feols(log(live_mass) ~ log(rich) + log(laggedrich) + ihs(even) | newplotid + site.by.yeardummy, comb)
esttex(MainMod_Rich, MainMod_Rich_sitecluster, MainMod_RichEven, MainMod_RichLag, MainMod_RichEvenLag, MainMod_Simpson,
coefstat = "se", replace = TRUE,
file = "./output/Table_S2_R_se.tex")
esttex(MainMod_Rich, MainMod_Rich_sitecluster,MainMod_RichEven, MainMod_RichLag, MainMod_RichEvenLag, MainMod_Simpson,
coefstat = "confint", replace = TRUE,
file = "./output/Table_S2_R_ci.tex")
